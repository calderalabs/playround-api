<style type="text/css">
  div.auto_complete {
    width: 350px;
    background: #fff;
    z-index: 1;
  }
  
  div.auto_complete ul {
    border:1px solid #888;
    margin:0;
    padding:0;
    width:100%;
    list-style-type:none;
  }
  
  div.auto_complete ul li {
    margin:0;
    padding:3px;
  }
  
  div.auto_complete ul li .latitude, div.auto_complete ul li .longitude {
    display: none;
  }
  
  div.auto_complete ul li.selected {
    background-color: #ffb;
  }
  
  div.auto_complete ul strong.highlight {
    color: #800; 
    margin:0;
    padding:0;
  }
</style>

<%= javascript_include_tag :defaults %>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

<script type="text/javascript">
  jQuery.noConflict();

  jQuery(document).ready(function() {
    var latlng = new google.maps.LatLng(parseFloat(jQuery("#arena_latitude").attr("value")),
                                        parseFloat(jQuery("#arena_longitude").attr("value")));

    var myOptions = {
      zoom: 15,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    map = new google.maps.Map(document.getElementById("location_map"),
        myOptions);

    marker = new google.maps.Marker({
        position: latlng, 
        map: map,
        draggable: true,
      });

    google.maps.event.addListener(marker, 'position_changed', function() {
      var latLng = marker.getPosition();

      jQuery("#arena_latitude").attr('value', latLng.lat().toString(10));
      jQuery("#arena_longitude").attr('value', latLng.lng().toString(10));
    });
  });
</script>

<%= form_for(@arena) do |f| %>
  <% if @arena.errors.any? %>
    <div class="error">
      <ul>
      <% @arena.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :name %><br />
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <%= f.label :description %><br />
    <%= f.text_area :description %>
  </div>

  <div class="field">
    <%= label_tag 'address' %><br />
    <%= text_field_tag 'address' %>
  </div>

  <%= f.hidden_field :latitude %>
  <%= f.hidden_field :longitude %>

  <div class="auto_complete" id="address_auto_complete"></div>

  <%= auto_complete_field 'address', :url => autocomplete_address_arenas_path, :select => 'address', :method => :get,
      :after_update_element => "function(element, value) {\
                                  var position = new google.maps.LatLng(parseFloat(jQuery(value).find('.latitude').first().text()),\
                                  parseFloat(jQuery(value).find('.longitude').first().text()));\
                                  marker.setPosition(position);\
                                  map.setCenter(position);\
                                }" %>

  <div id="location_map" style="width: 500px; height: 500px;"></div>

  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>